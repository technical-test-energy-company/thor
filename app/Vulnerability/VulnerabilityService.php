<?php

namespace App\Vulnerability;

use App\User\User;
use Illuminate\Pagination\CursorPaginator;
use Illuminate\Support\Facades\Log;
use Infrastructure\Constants\Constants;

class VulnerabilityService
{
    public function index(array $data): CursorPaginator
    {
        $limit = $data['limit'];
        $response = Vulnerability::orderBy(Constants::ID)->cursorPaginate($limit);

        return $response;
    }

    public function store(array $data): Vulnerability
    {
        $vulnerability = Vulnerability::create($data);
        VulnerabilityEnrichmentJob::dispatch($vulnerability);

        return $vulnerability;
    }

    public function update(array $data, Vulnerability $vulnerability): Vulnerability
    {
        $vulnerability->updateOrFail($data);

        return $vulnerability->fresh();
    }

    public function destroy(Vulnerability $vulnerability, User $user): void
    {
        $vulnerability->deleteOrFail();

        $userId = $user->id;
        $vulnerabilityId = $vulnerability->id;
        $message = "User with id $userId deleted Vulnerability with id $vulnerabilityId";
        Log::notice($message);
    }
}
