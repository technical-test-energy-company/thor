<?php

namespace App\Vulnerability\Requests;

use App\Asset\Asset;
use Illuminate\Foundation\Http\FormRequest;
use Illuminate\Validation\Rule;
use Infrastructure\Constants\Constants;
use Infrastructure\Enums\RiskSeverity;

class StoreVulnerabilityRequest extends FormRequest
{
    public function rules(): array
    {
        return [
            Constants::CVE_ID => 'required|string|regex:/^CVE-\d{4}-\d{1,7}$/',
            Asset::FOREIGN_ID => 'required|string|exists:'.Asset::TABLE_NAME.','.Constants::PUBLIC_ID,
            'severity' => ['filled', Rule::enum(RiskSeverity::class)],
            'description' => 'filled|string|max:1000',
            'date_published' => 'filled|date',
            'scope' => 'filled|string|max:100',
            'refId' => 'filled|string',
            'title' => 'filled|string|max:100',
            'cvss' => 'filled|decimal:0,2|min:0|max:10',
            'acknowledged' => 'filled|boolean',
        ];
    }
}
