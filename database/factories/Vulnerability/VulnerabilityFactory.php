<?php

namespace Database\Factories\Vulnerability;

use App\Asset\Asset;
use App\Vulnerability\Vulnerability;
use Illuminate\Database\Eloquent\Factories\Factory;
use Infrastructure\Constants\Constants;
use Infrastructure\Enums\RiskSeverity;

class VulnerabilityFactory extends Factory
{
    protected $model = Vulnerability::class;

    public function definition(): array
    {
        return [
            Constants::PUBLIC_ID => Vulnerability::ID_PREFIX.fake()->numberBetween(1, 100),
            Constants::CVE_ID => fakeCve(),
            'severity' => fake()->randomElement(RiskSeverity::cases()),
            'description' => fake()->text(),
            'date_published' => fake()->dateTimeThisDecade(),
            'scope' => fake()->word(),
            'refId' => 'd'.fake()->numberBetween(1, 100),
            'title' => fake()->sentence(3),
            'cvss' => fakeRiskScore(),
            'acknowledged' => fake()->boolean(),
        ];
    }

    public function withAsset(string $assetId): static
    {
        return $this->state(fn () => [
            Asset::FOREIGN_ID => $assetId,
        ]);
    }
}
